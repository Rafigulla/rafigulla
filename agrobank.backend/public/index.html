<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .oneLog{
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Logs panel</h1>
    <a href="#" id="cancel">⬅️ Ortga</a>
    <ul id="logText"></ul>
    <ul class="list"></ul>
    <script>
        let backendApi = 'https://my.agrobank.uz';
        let list = document.querySelector('.list')
        let data = []
        let path = JSON.parse(window.localStorage.getItem('path')) || []

        const start = async()=>{
            let res = await request(path)
            render(res)
        }

        cancel.onclick = async() => {
           try {
            logText.innerHTML = null
            if (path.length > 1) {
                path.pop()
                window.localStorage.setItem('path', JSON.stringify(path))
                let res = await request(path)
                render(res)
            } else {
                path.pop()
                window.localStorage.setItem('path', JSON.stringify(path))
                let res = await request(path)
                render(res)
            }
           } catch (error) {
            
           }
        }

        const render = (data) => {
            if(!data?.length) return
            list.innerHTML = null
            data.forEach(el => {
                let li = document.createElement('li')
                let a = document.createElement('a')
                
                a.href = '#'
                a.textContent = el
                li.append(a)

                a.onclick = async () => {
                    path.push(el)
                    let res = await request(path)
                    window.localStorage.setItem('path', JSON.stringify(path))
                    render(res)
                }
                list.append(li)
            });
        }

        const request = async(data) => {
            try {
                console.log(data.length);
                if(data.length >= 5){
                    let res = await fetch(backendApi+'/new/my/api/v1/getLog/',{
                        method: 'POST',
                        headers: {
                            'Content-Type':'application/json'
                        },
                        body: JSON.stringify({
                            [data[0]]:data[0],
                            year: data[1],
                            month: data[2],
                            date: data[3],
                            file: data[4]
                        })
                    })
                    res = await res.json()

                    res[0].split('\n').forEach(el => {
                        let li = document.createElement('li')
                        li.textContent = el    
                        li.className = 'oneLog'
                        logText.append(li)
                    })
                    list.innerHTML = null
                } else {
                    let res = await fetch(backendApi+'/new/my/api/v1/getLog/',{
                        
                        method: 'POST',
                        headers: {
                            'Content-Type':'application/json'
                        },
                        body: JSON.stringify({
                            [data[0]]:data[0],
                            year: data[1],
                            month: data[2],
                            date: data[3]
                        })
                    })
                    res = await res.json()
                    return res
                }
            } catch (error) {
                if(error.status === 401) alert('test');
            }
        }
        start()

    </script>
</body>
</html>